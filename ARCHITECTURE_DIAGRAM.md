# Visual Architecture Diagram - Smart Edge-AI CCTV

## ğŸ¬ Complete System Flow

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ                     SMART EDGE-AI CCTV SYSTEM                        â”ƒ
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          CAMERA LAYER                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   cv2.VideoCapture()  â”‚
                    â”‚   Raw Frame: 1920x1080â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       AI PROCESSING LAYER                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           AIProcessingPipeline.process_frame()               â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  Step 1: Motion Detection                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚  â”‚
â”‚  â”‚  â”‚ MotionDetector.detect(frame)            â”‚                â”‚  â”‚
â”‚  â”‚  â”‚ - Convert to grayscale                  â”‚                â”‚  â”‚
â”‚  â”‚  â”‚ - Gaussian blur (noise reduction)       â”‚                â”‚  â”‚
â”‚  â”‚  â”‚ - Frame difference (current vs previous)â”‚                â”‚  â”‚
â”‚  â”‚  â”‚ - Threshold & contour detection         â”‚                â”‚  â”‚
â”‚  â”‚  â”‚ Returns: [(x,y,w,h), ...]               â”‚                â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚  â”‚
â”‚  â”‚                        â”‚                                     â”‚  â”‚
â”‚  â”‚  Step 2: ROI Validation                                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚  â”‚
â”‚  â”‚  â”‚ For each bounding box:                  â”‚                â”‚  â”‚
â”‚  â”‚  â”‚   if inside_roi(x, y, w, h):            â”‚                â”‚  â”‚
â”‚  â”‚  â”‚     roi_triggered = True                â”‚                â”‚  â”‚
â”‚  â”‚  â”‚     box_color = RED                     â”‚                â”‚  â”‚
â”‚  â”‚  â”‚   else:                                 â”‚                â”‚  â”‚
â”‚  â”‚  â”‚     box_color = GREEN                   â”‚                â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚  â”‚
â”‚  â”‚                        â”‚                                     â”‚  â”‚
â”‚  â”‚  Step 3: Context Classification                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚  â”‚
â”‚  â”‚  â”‚ State Machine:                          â”‚                â”‚  â”‚
â”‚  â”‚  â”‚   IDLE â†’ motion detected â†’ MOTION       â”‚                â”‚  â”‚
â”‚  â”‚  â”‚   MOTION â†’ roi_triggered â†’ ALERT        â”‚                â”‚  â”‚
â”‚  â”‚  â”‚   ALERT â†’ cooldown â†’ IDLE               â”‚                â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚  â”‚
â”‚  â”‚                        â”‚                                     â”‚  â”‚
â”‚  â”‚  Step 4: Visual Overlays                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Bounding boxes (colored)              â”‚                â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Labels ("Motion #1 [ROI]")            â”‚                â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Confidence scores (87%)               â”‚                â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Status indicator (IDLE/MOTION/ALERT)  â”‚                â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ AI active badge                       â”‚                â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Timestamp                             â”‚                â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Motion counter                        â”‚                â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Animated banners                      â”‚                â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ ROI boundary                          â”‚                â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚  â”‚
â”‚  â”‚                        â”‚                                     â”‚  â”‚
â”‚  â”‚         Returns: Processed Frame (with all overlays)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  cv2.imencode(".jpg") â”‚
                    â”‚  JPEG Quality: 85%    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        STREAMING LAYER                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              FastAPI StreamingResponse                       â”‚  â”‚
â”‚  â”‚  Content-Type: multipart/x-mixed-replace; boundary=frame     â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  --frame                                                      â”‚  â”‚
â”‚  â”‚  Content-Type: image/jpeg                                    â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  [JPEG bytes with AI overlays]                               â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  --frame                                                      â”‚  â”‚
â”‚  â”‚  Content-Type: image/jpeg                                    â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  [JPEG bytes with AI overlays]                               â”‚  â”‚
â”‚  â”‚  ...                                                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   HTTP GET /live      â”‚
                    â”‚   localhost:8000      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND LAYER                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    React App (localhost:3000)                â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  <img ref={imgRef} src="http://localhost:8000/live" />       â”‚  â”‚
â”‚  â”‚    â”‚                                                          â”‚  â”‚
â”‚  â”‚    â””â”€â–º Displays AI-processed video stream                    â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  useEffect(() => {                                            â”‚  â”‚
â”‚  â”‚    setInterval(() => {                                        â”‚  â”‚
â”‚  â”‚      fetch("http://localhost:8000/status")                   â”‚  â”‚
â”‚  â”‚        .then(data => setAiStatus(data.ai_status))            â”‚  â”‚
â”‚  â”‚    }, 2000)                                                   â”‚  â”‚
â”‚  â”‚  })                                                           â”‚  â”‚
â”‚  â”‚    â”‚                                                          â”‚  â”‚
â”‚  â”‚    â””â”€â–º Polls AI status every 2 seconds                       â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  <div className="ai-status-badge">                           â”‚  â”‚
â”‚  â”‚    âš¡ AI | {aiStatus}                                        â”‚  â”‚
â”‚  â”‚  </div>                                                       â”‚  â”‚
â”‚  â”‚    â”‚                                                          â”‚  â”‚
â”‚  â”‚    â””â”€â–º Shows real-time AI state (IDLE/MOTION/ALERT)          â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ State Machine Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AI STATE MACHINE                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚     IDLE     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚         â”‚   (Green)    â”‚           â”‚
          â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
          â”‚                â”‚                   â”‚
          â”‚                â”‚ Motion Detected   â”‚
          â”‚                â–¼                   â”‚
          â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
          â”‚         â”‚    MOTION    â”‚           â”‚
          â”‚         â”‚   (Yellow)   â”‚           â”‚
          â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
          â”‚                â”‚                   â”‚
          â”‚                â”‚ Motion Stopped    â”‚
          â”‚                â–¼                   â”‚
          â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
          â”‚         â”‚  ROI Check?  â”‚           â”‚
          â”‚         â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜           â”‚
          â”‚            â”‚        â”‚              â”‚
          â”‚       YES  â”‚        â”‚ NO           â”‚
          â”‚            â–¼        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚     â”‚    ALERT     â”‚
          â”‚     â”‚    (Red)     â”‚
          â”‚     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚            â”‚
          â”‚            â”‚ Cooldown (5 seconds)
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

State Durations:
- IDLE: Indefinite (until motion)
- MOTION: 0.5s minimum before snapshot
- ALERT: Until cooldown expires
- Cooldown: 5 seconds

Triggers:
- IDLE â†’ MOTION: Motion detected in any area
- MOTION â†’ ALERT: Motion detected in ROI
- ALERT â†’ IDLE: Cooldown period elapsed
- MOTION â†’ IDLE: Motion stopped (no ROI trigger)
```

---

## ğŸ“Š Frame Processing Timeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               SINGLE FRAME PROCESSING (33ms @ 30fps)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Time (ms)
  0  â”œâ”€â–º Camera Capture (cv2.VideoCapture.read())
     â”‚   â””â”€ Raw BGR frame: 1920x1080x3 bytes
     â”‚
  5  â”œâ”€â–º Motion Detection
     â”‚   â”œâ”€ RGB to Grayscale conversion
     â”‚   â”œâ”€ Gaussian blur (21x21 kernel)
     â”‚   â”œâ”€ Frame difference (current - previous)
     â”‚   â”œâ”€ Threshold (binary mask)
     â”‚   â”œâ”€ Morphological operations (dilate)
     â”‚   â””â”€ Contour detection
     â”‚   Returns: [(x,y,w,h), (x,y,w,h), ...]
     â”‚
 15  â”œâ”€â–º ROI Validation & Overlay Drawing
     â”‚   For each detected contour:
     â”‚   â”œâ”€ Check if inside ROI
     â”‚   â”œâ”€ Calculate confidence score
     â”‚   â”œâ”€ Draw bounding box (2px border)
     â”‚   â”œâ”€ Draw label text
     â”‚   â””â”€ Draw confidence percentage
     â”‚
 20  â”œâ”€â–º State Machine Update
     â”‚   â”œâ”€ Analyze motion patterns
     â”‚   â”œâ”€ Update state (IDLE/MOTION/ALERT)
     â”‚   â”œâ”€ Trigger banner animations
     â”‚   â””â”€ Update timestamps
     â”‚
 25  â”œâ”€â–º Visual Overlays Rendering
     â”‚   â”œâ”€ ROI boundary (red rectangle)
     â”‚   â”œâ”€ Status text (bottom-left)
     â”‚   â”œâ”€ Timestamp (bottom-left)
     â”‚   â”œâ”€ AI indicator (top-left)
     â”‚   â”œâ”€ Motion counter (top-right)
     â”‚   â””â”€ Animated banner (top, conditional)
     â”‚
 28  â”œâ”€â–º JPEG Encoding
     â”‚   â””â”€ cv2.imencode(".jpg", quality=85)
     â”‚   Input: Processed frame (BGR)
     â”‚   Output: JPEG bytes (~50-150KB)
     â”‚
 33  â”œâ”€â–º Stream to Client
     â”‚   â””â”€ Yield frame bytes to StreamingResponse
     â”‚
     â–¼
  Repeat for next frame...
```

---

## ğŸ—ï¸ File Structure & Dependencies

```
F:\CCTV\
â”‚
â”œâ”€â”€ backend/
â”‚   â””â”€â”€ main_api.py â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Main API entry point
â”‚       â”œâ”€ FastAPI app             â”‚
â”‚       â”œâ”€ CORS middleware          â”‚ Imports
â”‚       â”œâ”€ GET /live               â”‚
â”‚       â”œâ”€ POST /stop               â”‚
â”‚       â”œâ”€ GET /status              â”‚
â”‚       â””â”€ gen_frames()             â”‚
â”‚           â””â”€ Uses â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                   â”‚        â”‚
â”œâ”€â”€ core/                           â”‚        â”‚
â”‚   â”œâ”€â”€ ai_pipeline.py â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ AI processing engine
â”‚   â”‚   â”œâ”€ AIProcessingPipeline             â”‚
â”‚   â”‚   â”œâ”€ process_frame()                  â”‚
â”‚   â”‚   â”œâ”€ _update_state()                  â”‚
â”‚   â”‚   â””â”€ _render_overlays()               â”‚
â”‚   â”‚       Uses: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                    â”‚  â”‚
â”‚   â”œâ”€â”€ motion_detector.py â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”˜ Motion detection
â”‚   â”‚   â””â”€ MotionDetector                â”‚
â”‚   â”‚       â””â”€ detect(frame)             â”‚
â”‚   â”‚           Returns: boxes, thresh   â”‚
â”‚   â”‚                                    â”‚
â”‚   â”œâ”€â”€ roi.py â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   ROI validation
â”‚   â”‚   â”œâ”€ draw_roi(frame)
â”‚   â”‚   â””â”€ inside_roi(x, y, w, h)
â”‚   â”‚
â”‚   â”œâ”€â”€ alerts.py                            Alert system
â”‚   â”‚   â”œâ”€ motion_beep()
â”‚   â”‚   â”œâ”€ alert_siren()
â”‚   â”‚   â””â”€ alert_console()
â”‚   â”‚
â”‚   â””â”€â”€ video_stream.py                      Camera access
â”‚       â””â”€ get_camera()
â”‚
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ timer.py                             Time utilities
â”‚   â”‚   â””â”€ get_time_string()
â”‚   â”‚
â”‚   â””â”€â”€ overlay.py                           Overlay helpers
â”‚       â””â”€ draw_alert_message()
â”‚
â”œâ”€â”€ config/
â”‚   â””â”€â”€ settings.py                          Configuration
â”‚       â”œâ”€ CAMERA_INDEX = 0
â”‚       â”œâ”€ MIN_CONTOUR_AREA = 1500
â”‚       â””â”€ ROI_TOP_LEFT, ROI_BOTTOM_RIGHT
â”‚
â””â”€â”€ cctv/                                    React frontend
    â”œâ”€â”€ public/
    â””â”€â”€ src/
        â”œâ”€â”€ App.js â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” Main component
        â”‚   â”œâ”€ toggleLive()                 â”‚
        â”‚   â”œâ”€ useEffect (status polling)   â”‚
        â”‚   â”œâ”€ AI status badge               â”‚
        â”‚   â””â”€ <img src="/live" />          â”‚
        â”‚                                   â”‚
        â””â”€â”€ App.css                         â”‚ Styling
            â”œâ”€ .live-btn                    â”‚
            â”œâ”€ .ai-status-badge             â”‚
            â”œâ”€ .status-idle/.motion/.alert  â”‚
            â””â”€ @keyframes pulse             â”‚
                                            â”‚
      Calls API: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      - GET http://localhost:8000/live
      - POST http://localhost:8000/stop
      - GET http://localhost:8000/status
```

---

## ğŸ”Œ API Communication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  FRONTEND â†” BACKEND API                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. User Clicks "LIVE" Button
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   
   Frontend                          Backend
   â”€â”€â”€â”€â”€â”€â”€â”€                          â”€â”€â”€â”€â”€â”€â”€
   
   [Click LIVE]
        â”‚
        â”œâ”€â–º imgRef.current.src = 
        â”‚   "http://localhost:8000/live"
        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  GET /live
                                         â”‚
                                         â”œâ”€ streaming = True
                                         â”œâ”€ Initialize AI pipeline
                                         â”œâ”€ Start gen_frames()
                                         â”‚  â””â”€â–º Infinite loop:
                                         â”‚      capture â†’ AI â†’ encode â†’ yield
                                         â”‚
                                    â—„â”€â”€â”€â”€â”´â”€ StreamingResponse
        MJPEG stream starts            (multipart/x-mixed-replace)
        â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        â”‚
        â””â”€â–º <img> displays frames


2. Status Polling (Every 2 Seconds)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   
   Frontend                          Backend
   â”€â”€â”€â”€â”€â”€â”€â”€                          â”€â”€â”€â”€â”€â”€â”€
   
   [useEffect interval]
        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  GET /status
                                         â”‚
                                         â””â”€ Return {
                                              "streaming": true,
                                              "ai_status": "MOTION",
                                              "camera_active": true
                                            }
        â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        â”‚
        â””â”€â–º setAiStatus("MOTION")
            â”‚
            â””â”€â–º Update badge: âš¡ AI | MOTION


3. User Clicks "STOP" Button
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   
   Frontend                          Backend
   â”€â”€â”€â”€â”€â”€â”€â”€                          â”€â”€â”€â”€â”€â”€â”€
   
   [Click STOP]
        â”‚
        â”œâ”€â–º imgRef.current.src = ""
        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º  POST /stop
                                         â”‚
                                         â”œâ”€ streaming = False
                                         â”œâ”€ cap.release()
                                         â”œâ”€ ai_pipeline.reset()
                                         â”‚
                                    â—„â”€â”€â”€â”€â”´â”€ {
        â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      "status": "stopped",
        â”‚                                  "ai_pipeline": "reset"
        â”‚                                }
        â””â”€â–º console.log("Camera stopped")
```

---

## ğŸ¨ Visual Overlay Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frame Width: 1920px, Height: 1080px                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ  ğŸŸ¡ MOTION DETECTED (banner, animated slide-down)          â”ƒ y=0-50
â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”«
â”ƒ                                                            â”ƒ
â”ƒ âš¡ AI | MOTION          AI PROCESSING: ACTIVE  OBJECTS: 2 â”ƒ y=25
â”ƒ (status badge)          (top-left text)     (top-right)   â”ƒ
â”ƒ                                                            â”ƒ
â”ƒ    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—                                  â”ƒ
â”ƒ    â•‘   Motion #1       â•‘ 87%                              â”ƒ
â”ƒ    â•‘   (green box)     â•‘                                  â”ƒ
â”ƒ    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                  â”ƒ
â”ƒ                                                            â”ƒ
â”ƒ         â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“                                 â”ƒ
â”ƒ         â”ƒ  Motion #2    â”ƒ 94%                             â”ƒ
â”ƒ         â”ƒ  [ROI]        â”ƒ                                 â”ƒ
â”ƒ         â”ƒ  (red box)    â”ƒ                                 â”ƒ
â”ƒ         â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›                                 â”ƒ
â”ƒ                                                            â”ƒ
â”ƒ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”ƒ
â”ƒ â”‚ ROI Boundary (red rectangle, 2px border)            â”‚  â”ƒ
â”ƒ â”‚                                                      â”‚  â”ƒ
â”ƒ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”ƒ
â”ƒ                                                            â”ƒ
â”ƒ STATUS: MOTION                                   12:34:56 â”ƒ y=1045
â”ƒ (color-coded text)                              (timestamp)â”ƒ y=1070
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›

Overlay Coordinates:
- Banner: (0, 0) to (width, 50)
- AI Badge: (20, 20)
- AI Text: (10, 25)
- Objects Counter: (width-120, 25)
- Bounding Boxes: Dynamic based on detection
- ROI Border: (0, 0) to (width-1, height-1) [full frame]
- Status: (10, height-35)
- Timestamp: (10, height-10)

Colors (BGR):
- Green: (0, 255, 0)
- Yellow: (0, 255, 255)
- Red: (0, 0, 255)
- White: (255, 255, 255)
- Black: (0, 0, 0)

Fonts:
- cv2.FONT_HERSHEY_SIMPLEX
- Sizes: 0.4 to 0.9
- Thickness: 1 to 3
```

---

## ğŸ§  Memory & Performance Profile

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SYSTEM RESOURCE USAGE                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Backend Process (Python + FastAPI)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component          Memory   CPU  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OpenCV             ~50 MB   15%  â”‚
â”‚ AI Pipeline        ~30 MB   20%  â”‚
â”‚ FastAPI/Uvicorn    ~40 MB    5%  â”‚
â”‚ Frame Buffers      ~60 MB   10%  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL             ~180 MB   50%  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Frontend Process (Node + React)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component          Memory   CPU  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Node.js            ~80 MB    5%  â”‚
â”‚ React App          ~40 MB    3%  â”‚
â”‚ Dev Server         ~30 MB    2%  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL             ~150 MB   10%  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Browser (Chrome/Edge)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component          Memory   CPU  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ React Renderer     ~60 MB    8%  â”‚
â”‚ MJPEG Decoder      ~40 MB   12%  â”‚
â”‚ DOM/JS             ~50 MB    5%  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ TOTAL             ~150 MB   25%  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Network Bandwidth:
- 1920x1080 @ 30fps, JPEG 85%
- ~3-5 MB/s (depends on motion)
- ~18-30 GB/hour (continuous)

Optimization Tips:
- Lower resolution â†’ Less memory
- Lower JPEG quality â†’ Less bandwidth
- Higher MIN_CONTOUR_AREA â†’ Less CPU
- Skip frames (process every 2nd) â†’ Half CPU
```

---

**End of Visual Architecture**

This diagram shows the complete flow from camera capture to frontend display, including all AI processing stages, state management, and communication protocols.

**Key**: Every frame flows through the AI pipeline before reaching the user!
